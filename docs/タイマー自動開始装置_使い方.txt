================================================
  TETRIS 99 マージンタイマー自動開始装置 v1.13
================================================

■ 目次 ■

・動作要件
・マージンタイマーの導入
・OBSの準備
・キャプチャ映像の上下左右に黒縁がある場合の対処方法
・タイマー自動開始装置の使い方
・タイマー自動開始装置の状態
・ウィンドウプロジェクター ウィンドウの注意事項
・対話ウィンドウの注意事項
・タイマー状態のリセット方法
・Q & A
・用語説明

==========================================================================================

■ 動作要件 ■

・Windowsを搭載した配信用パソコン

・HDMIキャプチャボード
  ※カメラなどでNintendo Switchの画面を直撮りしている映像には対応しません

・OS: Windows 10 Version 1903以上

・OBS Studioがインストール済かつ起動中であること
  ※Streamlabs OBS、XSplitは対応していません

・OBSの言語設定が日本語であること

・以下の仕様を満たしたマージンタイマー(以下、タイマーと呼ぶ)が存在すること
  - OBSの内蔵ブラウザ機能を使ったタイマーであること
  - 対話ウィンドウにてEnterキーでタイマー開始、Delキーでタイマー消去か終了ができること

  ※自作のTetris99MarginTimerで動作確認を行っております
    https://github.com/sshock-tetris/Tetris99MarginTimer

・キャプチャ映像の上下左右に黒縁がないこと
  ※黒縁がある場合は調整が必要です

・色設定が正しいこと
  ※色情報を元に認識しているので、Switchの設定から色を反転したりグレースケールにしていると
    認識できません
  ※色が通常より明るい、もしくは暗い場合(キャプチャボードの設定が不適切なことが一因)は正し
    く認識できない可能性があります。(例: チームバトルの背景が白飛びしている、など)

・キャプチャ映像以外の「ウィンドウ プロジェクター (ソース)」ウィンドウが存在しないこと


■ マージンタイマーの導入 ■

----------------------------------------------------------
【2024/06/15より前にマージンタイマーを導入した方へ】

最新のマージンタイマーに更新する必要があります。

https://github.com/sshock-tetris/Tetris99MarginTimer
から、最新版のマージンタイマーを入手し、既存のマージンタイ
マーを最新版に上書きしてください。
古いまま放置していると、タイマー消去が行われなくなります。
----------------------------------------------------------

※タイマーを導入済の場合は、以下の手順はスキップしてください。

1. ソースにタイマーを追加する。

2. タイマーの名前をMarginTimerに変更する。
   ※スペルミスや余計な空白が入っていると認識しません


■ OBSの準備 ■

1. MarginTimerを右クリックして「対話」メニューを選ぶ。
   →「'MarginTimer'の相互作用」ウィンドウが表示される (ここでは対話ウィンドウと呼びます)

2. キャプチャボードの映像ソースを右クリックして「ウィンドウ プロジェクター (ソース)」メニ
   ューを選ぶ。
   →「ウィンドウ プロジェクター (ソース) - ...」ウィンドウが表示される


■ キャプチャ映像の上下左右に黒縁がある場合の対処方法 ■

キャプチャ映像の上下左右が黒く額縁状態なっている場合、そのままではタイマー自動開始装置が
場面をうまく認識できません。以下の方法で上下左右の余白を削ってください。

1. キャプチャボードの映像ソースを右クリックして「フィルタ」メニューを選ぶ。
   →「'映像キャプチャデバイス'のためのフィルタ」ウィンドウが表示される

2. ウィンドウ左下(エフェクトフィルタ)の[+]ボタンをクリックし、「クロップ/パッド」を追加す
   る。

3. クロップ/パッドをクリックして、黒縁が表示されなくなるまで上下左右の数値を増やす。

4. 「閉じる」ボタンをクリックして閉じ、ウィンドウプロジェクター ウィンドウに上下左右の黒縁
   が解消されていることを確認する


■ タイマー自動開始装置の使い方 ■

1. OBSを準備する。

2. タイマー自動開始装置 (autoStartMarginTimer.exe)を起動する。
   ※OBSが管理者権限で動作している場合は、自動開始装置も管理者権限で起動してください

3. 「OBSを探す」ボタンをクリックする。
   →状態が「準備完了。待機中...」となる。

※「タイマー手動開始」ボタンをクリックすると、手動でタイマーを開始できます。自動開始の動作
  確認の前にこのボタンを押してみて、タイマーが動くのをチェックすることをおすすめします。


■ タイマー自動開始装置の状態 ■

・[自動開始できません]
  まだ準備ができておらず、タイマーを自動開始できない状態です。タイマー自動開始装置を起動し
  た時、および状態をリセットした時はこの状態となります。

・準備完了。待機中...
  準備ができ、ゲームが始まるのを待っている場合に表示されます。タイマーを自動開始できる状態
  です。タイマーが既に始まっている場合は、この状態になった時にタイマーを自動的に消去します。

・マッチング/ゲーム開始準備中
  マッチング中、またはゲーム開始準備中を認識した場合に表示されます。

・READY
  マッチングが終わりゲームが始まったことを認識した場合に表示されます。

・GO
  タイマーを開始した場合に表示されます。


■ ウィンドウプロジェクター ウィンドウの注意事項 ■

・自動開始装置がOBSのウィンドウを認識すると、ウィンドウプロジェクターのウィンドウサイズが
  自動的にリサイズされ、最大化・最小化ができない状態になります。

・ウィンドウプロジェクターは他のウィンドウに隠れても問題ありません。

・ウィンドウを画面外には移動しないでください。映像が更新されず、正常に認識できなくなります。

・自動開始装置の動作中にウィンドウを閉じると、OBSとの連携が解除されます。
  ウィンドウプロジェクターを開いてから自動開始装置の「OBSを探す」ボタンをクリックすること
  で、再び自動開始できるようになります。

・コンテキストメニュー(ウィンドウを右クリックした時に表示されるメニュー)のうち、「ウィンド
  ウをコンテンツに合わせる」を選択しないでください。
  ウィンドウサイズが変更されてしまい、正しく認識できなくなります。選択した場合は、一度ウィ
  ンドウプロジェクターを閉じて再度開き、自動開始装置の「OBSを探す」ボタンを押してください。


■ 対話ウィンドウの注意事項 ■

・サイズ変更は自由に行って問題ありません。

・自動開始装置の動作中に対話ウィンドウを閉じると、OBSとの連携が解除されます。
  もう一度対話ウィンドウを開いてから自動開始装置の「OBSを探す」ボタンをクリックすることで、
  再び自動開始できるようになります。


■ タイマー状態のリセット方法 ■

場面の認識がうまくいかず、タイマーを自動開始できない場合は、次の方法でタイマーの状態のリセ
ットを試してみてください。

1. タイマー自動開始装置のタイトルバーを右クリックする。
2. 「状態をリセット」メニューを選択する。

リセット後は、状態が[自動開始できません]に戻ります。「OBSを探す」ボタンをクリックして、タ
イマー自動開始装置の場面認識の準備を完了させてください。

この手順でもタイマーが動かない場合は、タイマー自動開始装置自体の再起動を推奨します。どの状
態でもかまわないので一度タイマー自動開始装置を閉じて、autoStartMarginTimer.exeを実行してく
ださい。


■ Q & A ■

[使用時]

Q. OBSを探すボタンを押しても「OBSのウィンドウを検出できません。」メッセージが表示されます。
A. OBSの準備ができていません。準備ができてから押してください。
   特に、以下の点をよくご確認ください。
   ・ソースのウィンドウ プロジェクターを表示していますか？配信映像のウィンドウ プロジェク
     ターは検出対象外です。
   ・MarginTimerのスペルが間違っていませんか？
   ・OBSの表示言語が日本語になっていますか？日本語以外ではウィンドウを開いていても検出でき
     ません。
   ・OBSが管理者権限で動作している場合、自動開始装置も管理者権限で動かさないとウィンドウ検
     出ができません。自動開始装置を管理者権限で起動し直してください。

Q. ゲームが始まっても状態が"準備完了。待機中..."から進みません。
A. 以下、ご確認ください。
   (1)正しいウィンドウ プロジェクターを表示していますか？
      オーバーレイが含まれた映像、動画ソースなど、キャプチャボードの映像でない場合は認識で
      きません。
   (2)ゲーム映像の色が反転、もしくはグレースケールになっていませんか？
      Switchの設定で色設定を変更している場合は認識できません。元の設定に戻してください。
   (3)キャプチャボードの映像の上下左右に黒縁がありませんか？
      額縁状態に縮小されている場合は額縁状態を解消するよう調整してください。
   (4)OBSを探す時に、何らかの問題でウィンドウプロジェクターのウィンドウサイズが変化しなか
      った場合も同様に場面の認識ができません。この現象が発生した場合は、作者までご連絡くだ
      さい。
   (5)ウィンドウ プロジェクター ウィンドウを画面外に移動していないか確認してください。

Q. 想定外のところでタイマーが動いてしまいます。
A. マージンタイマー自動開始装置は「マッチング中」または「ゲーム開始準備中」の表示部分を色
   で判断する仕様です。 実際のゲーム画面でなくても(録画であっても)マッチング中などの画面が
   映ればタイマーが動きます。
   たとえば、Switchのアルバムから静止画や動画を再生した場合、実際のゲーム画面と区別がつか
   ずタイマーが誤動作することがあります。
   誤動作した場合は、タイマー状態のリセットを試してください。

Q. ウィンドウプロジェクター ウィンドウや対話ウィンドウを閉じてしまった場合はどうする？
A. ウィンドウを閉じたことを自動開始装置が検知し、状態が[自動開始できません]になります。
   この時、無効化されていた「OBSを探す」ボタンが再び有効になります。ウィンドウプロジェクタ
   ー ウィンドウや対話ウィンドウをもう一度開いて、「OBSを探す」ボタンを押してください。

Q. ゲームの音は場面認識に関係ありますか？
A. 無関係です。映像さえあれば無音でも問題なく使用できます。

Q. 自動開始装置のOBSの準備後にマラソンやCPUバトルをやっても大丈夫？
A. 問題ありません。

Q. ホーム画面に戻っても大丈夫？
A. マッチング中に限り、ホーム画面に戻っている時間が長いほどタイマーを自動開始できる可能性
   が低くなります。
   できる限り問題が起こらないようにしていますが、仕様上どうしても認識できない場合がありま
   す。たとえば、対戦を始めてすぐにホーム画面に戻り、試合開始の準備が終わるまでしばらく待
   った後でゲーム画面に復帰した場合、自動開始装置は動作しません。これは「マッチング中」ま
   たは「ゲーム開始準備中」の表示部分を画像認識する仕様のため、その表示を見つけられなかっ
   たことで自動開始装置が場面を認識できなかったことによります。

Q. CPUバトルで動作する？
A. 動作しません。これは「マッチング中」の表示が場面を認識するのに必要で、CPUバトルにはその
   表示がないためです。

Q. シェアバトル、もちよりバトルで動作する？
A. 動作未確認です。「ゲーム開始準備中」の表示がなければ動作しないと思います。

Q. マラソンで動作する？
A. 動作しません。理由はCPUバトルの場合と同じですが、開始時間は右側に表示されているのでこの
   タイマーの出番はありませんよね？ :)

Q. v1.12以下からv1.13以上にアップデートしましたが、マージンタイマーが消えなくなりました。
A. 自動開始装置のv1.13のアップデートと同時に、マージンタイマーも更新があります。 マージン
   タイマーが古いままだと、タイマーが消えない現象が発生しますので、更新をお忘れなく。


■ 用語説明 ■

[マージン]
  試合の早期決着を目的に導入されているTETRIS 99固有のシステム。
  試合開始から10分が経過すると、ライン消去によって相手に送るライン数に上乗せされるようにな
  ります。30秒ごとに1ラインずつ上乗せされます。たとえば、10分なら+1ライン、11分なら+3ライ
  ン。TETRIS 99ではせり上がり予告の最大ライン数が12ラインのため、15分が経過すると最大とな
  ります(1ライン + 11ライン = 12ライン)。相手に送る場合に限定されるため、自陣のせり上がり
  予告との相殺にはマージンは適用されません。

==========================================================================================
Copyright (C) 2024 shellshock.
https://sshock-tetris.github.io/
